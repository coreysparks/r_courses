<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Corey Sparks">

<title>R and SQL</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="R_SQL_Day1_add_dbplyr_files/libs/clipboard/clipboard.min.js"></script>
<script src="R_SQL_Day1_add_dbplyr_files/libs/quarto-html/quarto.js"></script>
<script src="R_SQL_Day1_add_dbplyr_files/libs/quarto-html/popper.min.js"></script>
<script src="R_SQL_Day1_add_dbplyr_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R_SQL_Day1_add_dbplyr_files/libs/quarto-html/anchor.min.js"></script>
<link href="R_SQL_Day1_add_dbplyr_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R_SQL_Day1_add_dbplyr_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="R_SQL_Day1_add_dbplyr_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R_SQL_Day1_add_dbplyr_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R_SQL_Day1_add_dbplyr_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">R and SQL</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Corey Sparks </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="starting-out-introduction-to-sql-and-relational-databases" class="level2">
<h2 class="anchored" data-anchor-id="starting-out-introduction-to-sql-and-relational-databases">Starting Out: Introduction to SQL and Relational Databases</h2>
<p>SQL is a language designed for a very specific purpose: to interact with relational databases.</p>
<ul>
<li><strong>Database</strong>: A database is a structured collection of data. There are various different ways of structuring the database, and there may or may not be information about the relationship between entities in the database.</li>
<li><strong>Query</strong>: A query is a request for data from the database.</li>
<li><strong>Database Management System (DBMS)</strong>: A DBMS is a system of storing and managing databases, including querying the database.</li>
<li><strong>Relational Database Management System (RDBMS)</strong>: In an RDBMS, data records are stored in <em>tables</em>, each of which has a predefined set of <em>columns</em>, the pieces of information captured for each record in a table, and <em>rows</em> in the table, where each row has a place to store a value for every column in the table.</li>
</ul>
<p>Tables, including their columns, column types and relationships with other tables, are defined in a database <strong>schema</strong>. Many times, tables will contain a <strong>primary key</strong>, one or more columns that uniquely define a row. You can think of the primary key as a kind of ID, in which each row is given a unique ID. Tables can also contain <strong>foreign keys</strong>, which are column(s) that comprise the primary key in another table and, thus, provides a way of matching between multiple tables.</p>
<p>In this workbook, we will be using 2019 American Community Survey Public Use Microdata (PUMS). These are public-use data sets containing information about responses to the Census Bureau American Community Survey.</p>
<p>These are public-use data sets containing information about responses to the Census Bureau American Community Survey. Information about the ACS project can be found <a href="https://www.census.gov/programs-surveys/acs">here</a>.</p>
<p>We will be using the ACS PUMS dataset for Texas and California in our examples in this workbook.</p>
<p>You can find more information about the ACS datasets <a href="https://www.census.gov/programs-surveys/acs/microdata/access.2019.html">here</a> and the codebook for the data <a href="https://github.com/coreysparks/data/blob/master/pums_vars.xlsx?raw=true">here</a>. The codebook will show you the names of the variables in the data and a description of them.</p>
<p>Go to this site and download the database: <a href="https://drive.google.com/file/d/14Kwex8x3IPEGOLIP_lS3CXeU5iDB1cK1/view?usp=sharing" class="uri">https://drive.google.com/file/d/14Kwex8x3IPEGOLIP_lS3CXeU5iDB1cK1/view?usp=sharing</a></p>
<p><img src="images/paste-FCAC2628.png" class="img-fluid"></p>
<p>and save it to your local computer. I recommend putting the file <em>PUMS_data</em> in the User folder on your computer.</p>
</section>
<section id="writing-a-basic-query" class="level2">
<h2 class="anchored" data-anchor-id="writing-a-basic-query"><span style="color:green">Writing a Basic Query</span></h2>
<p>In order to analyze the data in a database, we need to query it, or request specific information about the data. Before we do that, run the following cell to establish a connection to the database.</p>
<p>In R we use a couple of libraries to do this. You will need to install the <code>DBI</code> and <code>RSQLite</code> packages first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.3.6     ✔ purrr   0.3.4
✔ tibble  3.1.8     ✔ dplyr   1.0.9
✔ tidyr   1.2.0     ✔ stringr 1.4.0
✔ readr   2.1.2     ✔ forcats 0.5.1
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DBI)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(RSQLite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next we establish the connection to our database. You will need to change the path of the file to the location on your computer where you downloaded the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span><span class="fu">dbConnect</span>(<span class="fu">SQLite</span>(),</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">dbname =</span> <span class="st">"C:/Users/ozd504/OneDrive - University of Texas at San Antonio/PUMS_data"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>con</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQLiteConnection&gt;
  Path: C:\Users\ozd504\OneDrive - University of Texas at San Antonio\PUMS_data
  Extensions: TRUE</code></pre>
</div>
</div>
<p>To see the tables in the connected database, use the <code>dbListTables()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbListTables</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "pums_hh_vars_csv" "pums_tx_ca"       "pums_tx_ca_hh"    "pums_vars_csv"   </code></pre>
</div>
</div>
<p>We see there are 4 tables present in the database.</p>
<p>Now we are ready to do our first query from the data. We want to query the first 10 rows of the <code>pums_tx_ca</code> table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT * FROM pums_tx_ca</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">   LIMIT 10;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        SERIALNO SPORDER WGTP PWGTP AGEP  WAGP ST TYPE SCHL SEX ESR FOD1P HISP
1  2019HU0000003       1   65    64   42 75000 48    1   22   1   1  2102    1
2  2019HU0000003       2   65    44   35     0 48    1   21   2   6  6000    1
3  2019HU0000003       3   65    67    9    -1 48    1   07   2   b  1099    1
4  2019HU0000003       4   65    67    8    -1 48    1   06   2   b  1099    1
5  2019HU0000003       5   65    69    0    -1 48    1   bb   2   b  1099    1
6  2019HU0000016       1  112   111   27 34800  6    1   21   2   1  1902    2
7  2019HU0000016       2  112   137   33     0  6    1   16   2   3  1099    2
8  2019HU0000016       3  112   107   24     0  6    1   16   2   6  1099    2
9  2019HU0000023       1   46    46   55     0 48    1   21   1   1  5506    1
10 2019HU0000023       2   46    51   56 38000 48    1   19   2   1  1099    2
   OCCP RAC1P      ST_label   TYPE_label
1  1010     6      Texas/TX Housing unit
2     9     6      Texas/TX Housing unit
3     9     6      Texas/TX Housing unit
4     9     6      Texas/TX Housing unit
5     9     6      Texas/TX Housing unit
6   120     8 California/CA Housing unit
7  5820     8 California/CA Housing unit
8     9     8 California/CA Housing unit
9  4810     1      Texas/TX Housing unit
10 5240     5      Texas/TX Housing unit
                                     SCHL_label SEX_label
1                               Master's degree      Male
2                             Bachelor's degree    Female
3                                       Grade 4    Female
4                                       Grade 3    Female
5                   N/A (less than 3 years old)    Female
6                             Bachelor's degree    Female
7                   Regular high school diploma    Female
8                   Regular high school diploma    Female
9                             Bachelor's degree      Male
10 1 or more years of college credit, no degree    Female
                      ESR_label                      FOD1P_label
1    Civilian employed, at work                 Computer Science
2            Not in labor force                        Fine Arts
3  N/A (less than 16 years old)                               NA
4  N/A (less than 16 years old)                               NA
5  N/A (less than 16 years old)                               NA
6    Civilian employed, at work                       Journalism
7                    Unemployed                               NA
8            Not in labor force                               NA
9    Civilian employed, at work Political Science And Government
10   Civilian employed, at work                               NA
                    HISP_label                           OCCP_label
1  Not Spanish/Hispanic/Latino             CMM-Computer Programmers
2  Not Spanish/Hispanic/Latino                                   NA
3  Not Spanish/Hispanic/Latino                                   NA
4  Not Spanish/Hispanic/Latino                                   NA
5  Not Spanish/Hispanic/Latino                                   NA
6                      Mexican               MGR-Financial Managers
7                      Mexican      OFF-Word Processors And Typists
8                      Mexican                                   NA
9  Not Spanish/Hispanic/Latino           SAL-Insurance Sales Agents
10                     Mexican OFF-Customer Service Representatives
                                                                                                                 RAC1P_label
1                                                                                                                Asian alone
2                                                                                                                Asian alone
3                                                                                                                Asian alone
4                                                                                                                Asian alone
5                                                                                                                Asian alone
6                                                                                                      Some Other Race alone
7                                                                                                      Some Other Race alone
8                                                                                                      Some Other Race alone
9                                                                                                                White alone
10 American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races</code></pre>
</div>
</div>
<p><strong>SELECT:</strong> We start out with the <code>SELECT</code> statement. The <code>SELECT</code> statement specifies which variables (columns) you want. - Here, we used <code>SELECT *</code>. The “<code>*</code>” just says that we want all the variables. - If we wanted a few columns, we would use the column names separated by commas instead of “<code>*</code>” (for example, <code>AGEP, SEX, ST</code>).</p>
<ul>
<li><p><strong>FROM:</strong> Now, let’s look at the next part of the query, <code>FROM pums_tx_ca</code>. This part of the query specifies the table, <code>pums_tx_ca</code>, from which we want to retrieve the data. Most of your queries will begin in this fashion, describing which columns you want and from which table.</p></li>
<li><p><strong>LIMIT:</strong> We typically include a <code>LIMIT</code> statement at the end of our query so that we don’t get overloaded with rows being output. Here, <code>LIMIT 10</code> means that we just want the first ten rows. Many times, the <code>LIMIT</code> that you want will be higher than 10 – you might generally prefer to use 1000 or so. Having a <code>LIMIT</code> for all queries is highly recommended even if you know only a few rows will be shown, since it acts as a safety precaution against (for example) displaying millions of rows of data.</p></li>
</ul>
<p>In this case, we’ve put everything in one line, but that’s not necessary. We could have split the code up into multiple lines, like so:</p>
<pre><code>SELECT * 
FROM pums_tx_ca
LIMIT 10;</code></pre>
<p>This gives the same output as our original query. Generally, once queries start getting longer, breaking up the code into multiple lines can be very helpful in organizing your code and making it easier to read.</p>
<p>Along those lines, note that we used a semi-colon at the end of the query to mark the end of the query. That isn’t absolutely necessary here, but it does help mark the end of a query and is required in other applications of SQL, so it’s good practice to use it.</p>
<blockquote class="blockquote">
<h3 id="side-note-about-capitalization" class="anchored">Side note about capitalization</h3>
<p>If you notice, we’ve been using all caps for SQL commands and all lowercase for data table and schema names. This is simply a convention, as SQL is not case sensitive. For example, we could have run <code>select * from pums_tx_ca limit 10;</code> and it would have given us the exact same output as the first query.</p>
</blockquote>
<blockquote class="blockquote">
<p>This does mean you need to be careful when using column names. If your column name has capital letters in it, you need use double quotes (e.g.&nbsp;<code>"AGEP"</code>) to preserve the capitalization. For this reason, you might find that using all lowercase letters in column names is preferable, which is what we’ve done here.</p>
</blockquote>
<p>Now, consider the following query. What do you think it will do?</p>
<pre><code>SELECT AGEP, ST 
FROM pums_tx_ca
LIMIT 10;</code></pre>
<p>We’ve changed the original query by using <code>AGEP, ST</code> instead of <code>*</code>, so we’ll only get the values from two columns, <code>AGEP</code> and <code>ST</code>. In addition, we’ve changed the value after <code>LIMIT</code> to be 100 instead of 10, so we’ll get the first 100 rows instead of the first 10 rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT AGEP, ST FROM pums_tx_ca</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="st">   LIMIT 10;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   AGEP ST
1    42 48
2    35 48
3     9 48
4     8 48
5     0 48
6    27  6
7    33  6
8    24  6
9    55 48
10   56 48</code></pre>
</div>
</div>
</section>
<section id="checkpoint-1-running-basic-queries" class="level2">
<h2 class="anchored" data-anchor-id="checkpoint-1-running-basic-queries"><span style="color:red">Checkpoint 1: Running Basic Queries</span></h2>
<p>Consider the following queries. What do you think they will do? Try figuring out what the output will look like, then run the code to see if you’re correct.</p>
<ul>
<li><code>SELECT * FROM pums_tx_ca LIMIT 25;</code></li>
<li><code>SELECT SCHL, SEX, HISP, OCCP FROM pums_tx_ca LIMIT 1000;</code></li>
<li><code>SELECT * FROM pums_tx_ca_hh LIMIT 100;</code></li>
</ul>
<p>Think about the following scenarios. What is the query you would use to answer these questions? Try them out.</p>
<ul>
<li>You want to see the first 100 rows of the variables containing informatoin on respondent’s race and wages variables.</li>
</ul>
</section>
<section id="checking-number-of-rows-and-duplicates" class="level2">
<h2 class="anchored" data-anchor-id="checking-number-of-rows-and-duplicates"><span style="color:green">Checking Number of Rows and Duplicates</span></h2>
<p>Let’s say we want to find out how many rows there are. You can do this by using a <code>COUNT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT COUNT(*) </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  COUNT(*)
1   625899</code></pre>
</div>
</div>
<p>Here, we used <code>COUNT(*)</code>, which does a count of all rows, regardless of <code>NULL</code> values. We can instead do a count of all non-<code>NULL</code> values of a certain variable by including that variable instead of <code>*</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT COUNT(ST) </span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  COUNT(ST)
1    625899</code></pre>
</div>
</div>
<p>But wait; what if there are duplicates in the data? We can check for them by using <code>DISTINCT</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT DISTINCT(ST) </span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ST
1 48
2  6</code></pre>
</div>
</div>
<p>And we see there are 2 states in the data.</p>
<p>This shows us all of the rows with distinct <code>ST</code> values; that is, all of the distinct state ids. Let’s count how many there are. To count them, all we have to do is put <code>COUNT()</code> around the <code>DISTINCT</code> part.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT COUNT ( DISTINCT ( ST ) )</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  COUNT ( DISTINCT ( ST ) )
1                         2</code></pre>
</div>
</div>
<blockquote class="blockquote">
<h3 id="building-up-a-query" class="anchored">Building Up a Query</h3>
<p>Notice that we wanted to count the number of distinct rows, but we first started from querying the rows with distinct <code>ST</code> first before adding in the <code>COUNT</code>. Though this is a simple example, this process of building up a query as we go is important, especially when we get to more complicated tasks. When writing a query, try to think about the basic parts first, and feel free to run intermediate steps (making sure to include <code>LIMIT</code>) as you go.</p>
</blockquote>
</section>
<section id="using-conditional-statements" class="level2">
<h2 class="anchored" data-anchor-id="using-conditional-statements"><span style="color:green">Using Conditional Statements</span></h2>
<p>Suppose we want to look at a subset of the data. We can use conditional statements to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT * </span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE AGEP &gt; 18</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="st">  LIMIT 10;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        SERIALNO SPORDER WGTP PWGTP AGEP  WAGP ST TYPE SCHL SEX ESR FOD1P HISP
1  2019HU0000003       1   65    64   42 75000 48    1   22   1   1  2102    1
2  2019HU0000003       2   65    44   35     0 48    1   21   2   6  6000    1
3  2019HU0000016       1  112   111   27 34800  6    1   21   2   1  1902    2
4  2019HU0000016       2  112   137   33     0  6    1   16   2   3  1099    2
5  2019HU0000016       3  112   107   24     0  6    1   16   2   6  1099    2
6  2019HU0000023       1   46    46   55     0 48    1   21   1   1  5506    1
7  2019HU0000023       2   46    51   56 38000 48    1   19   2   1  1099    2
8  2019HU0000026       1   87    88   21 28800  6    1   06   2   1  1099    2
9  2019HU0000026       4   87   124   44 25900  6    1   01   2   1  1099    2
10 2019HU0000068       1   56    56   25 13600 48    1   21   2   1  4101    1
   OCCP RAC1P      ST_label   TYPE_label
1  1010     6      Texas/TX Housing unit
2     9     6      Texas/TX Housing unit
3   120     8 California/CA Housing unit
4  5820     8 California/CA Housing unit
5     9     8 California/CA Housing unit
6  4810     1      Texas/TX Housing unit
7  5240     5      Texas/TX Housing unit
8  4030     8 California/CA Housing unit
9  4020     8 California/CA Housing unit
10  725     1      Texas/TX Housing unit
                                     SCHL_label SEX_label
1                               Master's degree      Male
2                             Bachelor's degree    Female
3                             Bachelor's degree    Female
4                   Regular high school diploma    Female
5                   Regular high school diploma    Female
6                             Bachelor's degree      Male
7  1 or more years of college credit, no degree    Female
8                                       Grade 3    Female
9                        No schooling completed    Female
10                            Bachelor's degree    Female
                    ESR_label                                   FOD1P_label
1  Civilian employed, at work                              Computer Science
2          Not in labor force                                     Fine Arts
3  Civilian employed, at work                                    Journalism
4                  Unemployed                                            NA
5          Not in labor force                                            NA
6  Civilian employed, at work              Political Science And Government
7  Civilian employed, at work                                            NA
8  Civilian employed, at work                                            NA
9  Civilian employed, at work                                            NA
10 Civilian employed, at work Physical Fitness Parks Recreation And Leisure
                    HISP_label                                  OCCP_label
1  Not Spanish/Hispanic/Latino                    CMM-Computer Programmers
2  Not Spanish/Hispanic/Latino                                          NA
3                      Mexican                      MGR-Financial Managers
4                      Mexican             OFF-Word Processors And Typists
5                      Mexican                                          NA
6  Not Spanish/Hispanic/Latino                  SAL-Insurance Sales Agents
7                      Mexican        OFF-Customer Service Representatives
8                      Mexican                EAT-Food Preparation Workers
9                      Mexican                                   EAT-Cooks
10 Not Spanish/Hispanic/Latino BUS-Meeting, Convention, And Event Planners
                                                                                                                 RAC1P_label
1                                                                                                                Asian alone
2                                                                                                                Asian alone
3                                                                                                      Some Other Race alone
4                                                                                                      Some Other Race alone
5                                                                                                      Some Other Race alone
6                                                                                                                White alone
7  American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races
8                                                                                                      Some Other Race alone
9                                                                                                      Some Other Race alone
10                                                                                                               White alone</code></pre>
</div>
</div>
<p>Using a query like the one above can be useful for finding if there are any data entry errors or missing values. Since it’s not possible to have an age less 0, if there are any rows with negative age, this is likely an error or the method used to code missing values (e.g.&nbsp;<code>-1</code>).</p>
<p>We can also use more complicated conditional statements.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT * </span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE AGEP &gt; 18 AND AGEP &lt;65</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="st">  LIMIT 10;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        SERIALNO SPORDER WGTP PWGTP AGEP  WAGP ST TYPE SCHL SEX ESR FOD1P HISP
1  2019HU0000003       1   65    64   42 75000 48    1   22   1   1  2102    1
2  2019HU0000003       2   65    44   35     0 48    1   21   2   6  6000    1
3  2019HU0000016       1  112   111   27 34800  6    1   21   2   1  1902    2
4  2019HU0000016       2  112   137   33     0  6    1   16   2   3  1099    2
5  2019HU0000016       3  112   107   24     0  6    1   16   2   6  1099    2
6  2019HU0000023       1   46    46   55     0 48    1   21   1   1  5506    1
7  2019HU0000023       2   46    51   56 38000 48    1   19   2   1  1099    2
8  2019HU0000026       1   87    88   21 28800  6    1   06   2   1  1099    2
9  2019HU0000026       4   87   124   44 25900  6    1   01   2   1  1099    2
10 2019HU0000068       1   56    56   25 13600 48    1   21   2   1  4101    1
   OCCP RAC1P      ST_label   TYPE_label
1  1010     6      Texas/TX Housing unit
2     9     6      Texas/TX Housing unit
3   120     8 California/CA Housing unit
4  5820     8 California/CA Housing unit
5     9     8 California/CA Housing unit
6  4810     1      Texas/TX Housing unit
7  5240     5      Texas/TX Housing unit
8  4030     8 California/CA Housing unit
9  4020     8 California/CA Housing unit
10  725     1      Texas/TX Housing unit
                                     SCHL_label SEX_label
1                               Master's degree      Male
2                             Bachelor's degree    Female
3                             Bachelor's degree    Female
4                   Regular high school diploma    Female
5                   Regular high school diploma    Female
6                             Bachelor's degree      Male
7  1 or more years of college credit, no degree    Female
8                                       Grade 3    Female
9                        No schooling completed    Female
10                            Bachelor's degree    Female
                    ESR_label                                   FOD1P_label
1  Civilian employed, at work                              Computer Science
2          Not in labor force                                     Fine Arts
3  Civilian employed, at work                                    Journalism
4                  Unemployed                                            NA
5          Not in labor force                                            NA
6  Civilian employed, at work              Political Science And Government
7  Civilian employed, at work                                            NA
8  Civilian employed, at work                                            NA
9  Civilian employed, at work                                            NA
10 Civilian employed, at work Physical Fitness Parks Recreation And Leisure
                    HISP_label                                  OCCP_label
1  Not Spanish/Hispanic/Latino                    CMM-Computer Programmers
2  Not Spanish/Hispanic/Latino                                          NA
3                      Mexican                      MGR-Financial Managers
4                      Mexican             OFF-Word Processors And Typists
5                      Mexican                                          NA
6  Not Spanish/Hispanic/Latino                  SAL-Insurance Sales Agents
7                      Mexican        OFF-Customer Service Representatives
8                      Mexican                EAT-Food Preparation Workers
9                      Mexican                                   EAT-Cooks
10 Not Spanish/Hispanic/Latino BUS-Meeting, Convention, And Event Planners
                                                                                                                 RAC1P_label
1                                                                                                                Asian alone
2                                                                                                                Asian alone
3                                                                                                      Some Other Race alone
4                                                                                                      Some Other Race alone
5                                                                                                      Some Other Race alone
6                                                                                                                White alone
7  American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races
8                                                                                                      Some Other Race alone
9                                                                                                      Some Other Race alone
10                                                                                                               White alone</code></pre>
</div>
</div>
<p>This subsets to rows in which AGEP is greater than 18 and AGEP is less than 65. That is, this subsets to people with ages between 18 and 65. Using OR works in the same way.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT * </span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE AGEP &gt; 18  OR AGEP &lt;65</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="st">  LIMIT 10;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        SERIALNO SPORDER WGTP PWGTP AGEP  WAGP ST TYPE SCHL SEX ESR FOD1P HISP
1  2019HU0000003       1   65    64   42 75000 48    1   22   1   1  2102    1
2  2019HU0000003       2   65    44   35     0 48    1   21   2   6  6000    1
3  2019HU0000003       3   65    67    9    -1 48    1   07   2   b  1099    1
4  2019HU0000003       4   65    67    8    -1 48    1   06   2   b  1099    1
5  2019HU0000003       5   65    69    0    -1 48    1   bb   2   b  1099    1
6  2019HU0000016       1  112   111   27 34800  6    1   21   2   1  1902    2
7  2019HU0000016       2  112   137   33     0  6    1   16   2   3  1099    2
8  2019HU0000016       3  112   107   24     0  6    1   16   2   6  1099    2
9  2019HU0000023       1   46    46   55     0 48    1   21   1   1  5506    1
10 2019HU0000023       2   46    51   56 38000 48    1   19   2   1  1099    2
   OCCP RAC1P      ST_label   TYPE_label
1  1010     6      Texas/TX Housing unit
2     9     6      Texas/TX Housing unit
3     9     6      Texas/TX Housing unit
4     9     6      Texas/TX Housing unit
5     9     6      Texas/TX Housing unit
6   120     8 California/CA Housing unit
7  5820     8 California/CA Housing unit
8     9     8 California/CA Housing unit
9  4810     1      Texas/TX Housing unit
10 5240     5      Texas/TX Housing unit
                                     SCHL_label SEX_label
1                               Master's degree      Male
2                             Bachelor's degree    Female
3                                       Grade 4    Female
4                                       Grade 3    Female
5                   N/A (less than 3 years old)    Female
6                             Bachelor's degree    Female
7                   Regular high school diploma    Female
8                   Regular high school diploma    Female
9                             Bachelor's degree      Male
10 1 or more years of college credit, no degree    Female
                      ESR_label                      FOD1P_label
1    Civilian employed, at work                 Computer Science
2            Not in labor force                        Fine Arts
3  N/A (less than 16 years old)                               NA
4  N/A (less than 16 years old)                               NA
5  N/A (less than 16 years old)                               NA
6    Civilian employed, at work                       Journalism
7                    Unemployed                               NA
8            Not in labor force                               NA
9    Civilian employed, at work Political Science And Government
10   Civilian employed, at work                               NA
                    HISP_label                           OCCP_label
1  Not Spanish/Hispanic/Latino             CMM-Computer Programmers
2  Not Spanish/Hispanic/Latino                                   NA
3  Not Spanish/Hispanic/Latino                                   NA
4  Not Spanish/Hispanic/Latino                                   NA
5  Not Spanish/Hispanic/Latino                                   NA
6                      Mexican               MGR-Financial Managers
7                      Mexican      OFF-Word Processors And Typists
8                      Mexican                                   NA
9  Not Spanish/Hispanic/Latino           SAL-Insurance Sales Agents
10                     Mexican OFF-Customer Service Representatives
                                                                                                                 RAC1P_label
1                                                                                                                Asian alone
2                                                                                                                Asian alone
3                                                                                                                Asian alone
4                                                                                                                Asian alone
5                                                                                                                Asian alone
6                                                                                                      Some Other Race alone
7                                                                                                      Some Other Race alone
8                                                                                                      Some Other Race alone
9                                                                                                                White alone
10 American Indian and Alaska Native tribes specified; or American Indian or Alaska Native, not specified and no other races</code></pre>
</div>
</div>
<p>This subsets to rows in which <code>AGEP</code> is greater than 18 or less than 65.</p>
<blockquote class="blockquote">
<h3 id="common-comparison-operators" class="anchored">Common Comparison Operators</h3>
</blockquote>
<blockquote class="blockquote">
<p>Though there are some more complicated comparison operators (if you’re curious, feel free to look up what <code>LIKE</code> and <code>IN</code> do), these should cover most of what you want to do. - <strong><code>=</code></strong>: equal to - <strong><code>!=</code></strong> or “<strong><code>&lt;&gt;</code></strong>”: not equal to - <strong><code>&lt;</code></strong>: less than - <strong><code>&lt;=</code></strong>: less-than-or-equal-to - <strong><code>&gt;</code></strong>: greater than - <strong><code>&gt;=</code></strong>: greater-than-or-equal-to - <strong><code>IS NULL</code></strong> and <strong><code>IS NOT NULL</code></strong>: The signifier of a row in a column not having a value is a special keyword: <code>NULL</code>. To check for <code>NULL</code>, you use <code>IS NULL</code> or <code>IS NOT NULL</code>, rather than “=” or “!=”. For example, to count the number of rows with <code>NULL</code> values for <code>c000</code> we might use the following:</p>
</blockquote>
<blockquote class="blockquote">
<pre><code>   SELECT count(*) 
   FROM pums_tx_ca
   WHERE WAGP IS NULL;</code></pre>
</blockquote>
</section>
<section id="creating-variables" class="level2">
<h2 class="anchored" data-anchor-id="creating-variables">Creating Variables</h2>
<p>Suppose we want to create a new column in the table that acts as a “flag” for which rows fit a certain condition, so that you can use them later. We can do this using the <code>ALTER TABLE</code> statement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con,</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'ALTER TABLE pums_tx_ca</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="st">  ADD over65 BOOL;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'UPDATE pums_tx_ca SET over65 = 0;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 625899</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbExecute</span>(con,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'UPDATE pums_tx_ca SET over65 = 1 WHERE AGEP &gt; 65;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 105882</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a> <span class="st">'select over65, AGEP,ST from pums_tx_ca</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="st"> limit 10;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   over65 AGEP ST
1       0   42 48
2       0   35 48
3       0    9 48
4       0    8 48
5       0    0 48
6       0   27  6
7       0   33  6
8       0   24  6
9       0   55 48
10      0   56 48</code></pre>
</div>
</div>
<p>Let’s break this down line by line. First, we use <code>ALTER TABLE</code>, then specify the table we want to alter. In this case, we want to alter the <code>pums_tx_ca</code> table. Then, we <code>ADD</code> a new column, <code>over65</code>. We designate this as a <code>BOOL</code> for boolean (that is, a TRUE/FALSE value) column.</p>
<p>After we create this new column, we need to fill it with the appropriate values. First, we’re going to set everything in the column to be 0 (or False). To do this, we use <code>UPDATE</code>, specify the appropriate table, then use <code>SET over65 = 0</code>.</p>
<p>Then, we replace the value with 1 (or True) if the value in <code>AGEP</code> for that row is above 65. We again use <code>UPDATE</code> in a similar manner, except we add a <code>WHERE</code> clause, so that it only set the value to TRUE if a certain condition is met – in this case, that <code>AGEP &gt; 65</code>.</p>
</section>
<section id="using-aggregation-functions" class="level2">
<h2 class="anchored" data-anchor-id="using-aggregation-functions"><span style="color:green">Using Aggregation Functions</span></h2>
<p>We’ve created a variable that indicates whether the person’s age is over 65 or not. What if we wanted to know how many people were over 65 and how many weren’t? We can now use the <code>GROUP BY</code> statement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT over65, COUNT(over65)</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY over65;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  over65 COUNT(over65)
1      0        520017
2      1        105882</code></pre>
</div>
</div>
<p>Here, the <code>GROUP BY</code> statement groups it into the categories of the variable. Since we’ve chosen to display the count, we can see the counts. We can also change the order in which the results are displayed so that it’s in increasing order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT over65, COUNT(over65)</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY over65</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY COUNT(over65);'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  over65 COUNT(over65)
1      1        105882
2      0        520017</code></pre>
</div>
</div>
<p>The <code>ORDER BY</code> statement orders the rows that it displays according to whatever you put after it. In this case, we chose the count of <code>over100</code>.</p>
<section id="using-group-by-with-multiple-variables" class="level3">
<h3 class="anchored" data-anchor-id="using-group-by-with-multiple-variables">Using GROUP BY with Multiple Variables</h3>
<p>For the next few queries, let’s try using a different table. The <code>pums_tx_ca_hh</code> table in the same <code>PUMS_data</code> database contains information about households that each person lives in. We can use this to, for example, look at how many households do not have access to the internet by state. <em>NOTE</em> ACCESS values of 3 indicate that a house has no access to the internet</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT ACCESS,ST, COUNT(*)</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca_hh</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY ACCESS, ST</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY ACCESS DESC;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ACCESS ST COUNT(*)
1      3  6     9521
2      3 48    10677
3      2  6     2445
4      2 48     2294
5      1  6   123642
6      1 48    90169</code></pre>
</div>
</div>
<p>This first groups by ACCESS (<code>ACCESS</code>) name, then it groups by state (<code>ST</code>), in that order.</p>
<p>Further, notice that we used <code>DESC</code> after <code>ORDER BY</code>. This orders in descending order instead of ascending order, so that we can see the areas with the highest values of <code>ACCESS</code> at the top.</p>
</section>
<section id="conditional-statements-after-aggregation" class="level3">
<h3 class="anchored" data-anchor-id="conditional-statements-after-aggregation">Conditional Statements After Aggregation</h3>
<p>Suppose we wanted to display only certain counts. We can use <code>HAVING</code> to do this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT ACCESS,ST, COUNT(*)</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca_hh</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY ACCESS, ST</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="st">  HAVING ACCESS = 3</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY ACCESS DESC;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  ACCESS ST COUNT(*)
1      3  6     9521
2      3 48    10677</code></pre>
</div>
</div>
<p>This displays on the numbers of households that don’t have internet access.</p>
</section>
<section id="using-different-aggregation-functions" class="level3">
<h3 class="anchored" data-anchor-id="using-different-aggregation-functions">Using Different Aggregation Functions</h3>
<p>What if we wanted to find the sum within each group, or the minimum or maximum value? We can use the appropriate aggregation function. To show this, let’s go back to our <code>pums_tx_ca</code> table.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbGetQuery</span>(con,</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">'SELECT over65, SEX_label, COUNT(over65), AVG(WAGP) AS avg_wage, MIN(WAGP), MAX(WAGP)</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="st">  FROM pums_tx_ca</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="st">  WHERE WAGP &gt; 0</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="st">  GROUP BY over65, SEX_label</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="st">  ORDER BY over65;'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  over65 SEX_label COUNT(over65) avg_wage MIN(WAGP) MAX(WAGP)
1      0    Female        136914 49224.06         4    571000
2      0      Male        150071 72825.69         4    571000
3      1    Female          8809 39265.85        10    571000
4      1      Male         10361 71231.26        30    571000</code></pre>
</div>
</div>
<p>Here, we’re finding the counts, average, minimum, and maximum value of the wages within each group, defined by respondent’s sex and their age group. These aggregation functions can be very useful.</p>
<blockquote class="blockquote">
<h3 id="side-note-aliasing" class="anchored">Side Note: Aliasing</h3>
<p>You may have noticed that we included a part using “<code>AS</code>,” followed by a new name, in the first line. When you ran the code, you might have noticed that the column labels were changed to these new names. This is called aliasing, and is done for readability and ease of access. Later on, aliasing will also help us more easily reference tables within the same query.</p>
</blockquote>
</section>
</section>
<section id="close-the-data-base-connection" class="level2">
<h2 class="anchored" data-anchor-id="close-the-data-base-connection">Close the data base connection</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dbDisconnect</span>(con)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="homework" class="level1">
<h1>Homework</h1>
<p>1) In three sentences or less, describe the steps you would take to connect to a datasource/server in R</p>
<p>2) Write the lines of code you would use to show the first ten lines of a database named <em>ds_census_unit3</em> in R</p>
<p>3) Write the lines of code you would use to extract the total number of distinct individuals in the <em>pums_tx_ca</em> table, using the <strong>SERIALNO</strong> as the unique identifier for each person</p>
<p>4) Modify question 3 to count the number of distinct persons in the pums_tx_ca table who are over between ages 29 and 40.</p>
</section>
<section id="using-dbplyr-to-do-queries" class="level1">
<h1>Using <code>dbplyr</code> to do queries</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dbplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    ident, sql</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span><span class="fu">dbConnect</span>(<span class="fu">SQLite</span>(),</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">dbname =</span> <span class="st">"C:/Users/ozd504/OneDrive - University of Texas at San Antonio/PUMS_data"</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>pums <span class="ot">&lt;-</span> <span class="fu">tbl</span>(con, <span class="st">"pums_tx_ca"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pums <span class="sc">%&gt;%</span> <span class="fu">select</span>(SERIALNO, AGEP, ST, WAGP)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [?? x 4]
# Database: sqlite 3.39.2 [C:\Users\ozd504\OneDrive - University of Texas at San Antonio\PUMS_data]
   SERIALNO       AGEP    ST  WAGP
   &lt;chr&gt;         &lt;int&gt; &lt;int&gt; &lt;int&gt;
 1 2019HU0000003    42    48 75000
 2 2019HU0000003    35    48     0
 3 2019HU0000003     9    48    -1
 4 2019HU0000003     8    48    -1
 5 2019HU0000003     0    48    -1
 6 2019HU0000016    27     6 34800
 7 2019HU0000016    33     6     0
 8 2019HU0000016    24     6     0
 9 2019HU0000023    55    48     0
10 2019HU0000023    56    48 38000
# … with more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pums <span class="sc">%&gt;%</span> <span class="fu">select</span>(SERIALNO, AGEP, ST, WAGP)<span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AGEP <span class="sc">&gt;</span> <span class="dv">18</span> <span class="sc">&amp;</span> AGEP<span class="sc">&lt;</span><span class="dv">65</span>, WAGP <span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="at">n =</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [10 x 4]
# Database: sqlite 3.39.2 [C:\Users\ozd504\OneDrive - University of Texas at San Antonio\PUMS_data]
   SERIALNO       AGEP    ST   WAGP
   &lt;chr&gt;         &lt;int&gt; &lt;int&gt;  &lt;int&gt;
 1 2019HU0000003    42    48  75000
 2 2019HU0000016    27     6  34800
 3 2019HU0000023    56    48  38000
 4 2019HU0000026    21     6  28800
 5 2019HU0000026    44     6  25900
 6 2019HU0000068    25    48  13600
 7 2019HU0000068    26    48  57000
 8 2019HU0000086    38    48 129000
 9 2019HU0000092    33     6 107000
10 2019HU0000092    37     6  87000</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>pums <span class="sc">%&gt;%</span> <span class="fu">select</span>(SERIALNO, AGEP, ST, WAGP)<span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AGEP <span class="sc">&gt;</span> <span class="dv">18</span>, WAGP <span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">over65  =</span> <span class="fu">ifelse</span>(AGEP <span class="sc">&gt;</span><span class="dv">65</span>, <span class="dv">1</span>, <span class="dv">0</span>))<span class="sc">%&gt;%</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ST, over65)<span class="sc">%&gt;%</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avgwage =</span> <span class="fu">mean</span>(WAGP), <span class="at">medwg =</span> <span class="fu">median</span>(WAGP))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by "ST". You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Missing values are always removed in SQL aggregation functions.
Use `na.rm = TRUE` to silence this warning
This warning is displayed once every 8 hours.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># Source:   SQL [4 x 4]
# Database: sqlite 3.39.2 [C:\Users\ozd504\OneDrive - University of Texas at San Antonio\PUMS_data]
# Groups:   ST
     ST over65 avgwage medwg
  &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
1     6      0  66893. 45000
2     6      1  61429. 32000
3    48      0  57296. 40000
4    48      1  50531. 28000</code></pre>
</div>
</div>
<section id="see-the-query" class="level3">
<h3 class="anchored" data-anchor-id="see-the-query">See the query!</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>pums <span class="sc">%&gt;%</span> <span class="fu">select</span>(SERIALNO, AGEP, ST, WAGP)<span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AGEP <span class="sc">&gt;</span> <span class="dv">18</span>, WAGP <span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">over65  =</span> <span class="fu">ifelse</span>(AGEP <span class="sc">&gt;</span><span class="dv">65</span>, <span class="dv">1</span>, <span class="dv">0</span>))<span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ST, over65)<span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avgwage =</span> <span class="fu">mean</span>(WAGP),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">medwg =</span> <span class="fu">median</span>(WAGP),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">samp =</span> <span class="fu">n</span>())<span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">show_query</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by "ST". You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;SQL&gt;
SELECT
  `ST`,
  `over65`,
  AVG(`WAGP`) AS `avgwage`,
  MEDIAN(`WAGP`) AS `medwg`,
  COUNT(*) AS `samp`
FROM (
  SELECT
    *,
    CASE WHEN (`AGEP` &gt; 65.0) THEN 1.0 WHEN NOT (`AGEP` &gt; 65.0) THEN 0.0 END AS `over65`
  FROM (
    SELECT `SERIALNO`, `AGEP`, `ST`, `WAGP`
    FROM `pums_tx_ca`
  )
  WHERE (`AGEP` &gt; 18.0) AND (`WAGP` != 0.0)
)
GROUP BY `ST`, `over65`</code></pre>
</div>
</div>
</section>
<section id="use-the-output-of-the-query-in-graph" class="level3">
<h3 class="anchored" data-anchor-id="use-the-output-of-the-query-in-graph">Use the output of the query in graph</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>pums <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(SERIALNO, AGEP, ST,SEX, WAGP)<span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(AGEP <span class="sc">&gt;</span> <span class="dv">18</span>, WAGP <span class="sc">!=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">over65  =</span> <span class="fu">ifelse</span>(AGEP <span class="sc">&gt;</span><span class="dv">65</span>, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">gender =</span> <span class="fu">ifelse</span>(SEX <span class="sc">==</span><span class="dv">1</span> , <span class="st">"Male"</span>, <span class="st">"Female"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ST, over65, gender)<span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avgwage =</span> <span class="fu">mean</span>(WAGP),</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">medwg =</span> <span class="fu">median</span>(WAGP),</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">samp =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> ST,</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> avgwage,</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill=</span><span class="fu">factor</span>(ST))<span class="sc">+</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"identity"</span>)<span class="sc">+</span></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>gender) <span class="sc">+</span></span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_dollar</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by "ST" and "over65". You can override using
the `.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="R_SQL_Day1_add_dbplyr_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>