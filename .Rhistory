ggtitle(label = "Relationship between Total Fertility and Infant Mortality", subtitle = "2008 Estimates")+
xlab(label = "TFR")+
ylab(label="IMR")
ggplot(data=prb,mapping= aes(x=TFR, y=IMR, color=Continent))+
geom_point()+
facet_wrap(~Continent)+
ggtitle(label = "Relationship between Total Fertility and Infant Mortality", subtitle = "2008 Estimates")+
xlab(label = "TFR")+
ylab(label="IMR")
ggplot(data=prb,mapping= aes(x=TFR, y=IMR))+
geom_point()+
geom_smooth( method = "lm")+
ggtitle(label = "Relationship between Total Fertility and Infant Mortality", subtitle = "2008 Estimates-linear fit")+
xlab(label = "TFR")+
ylab(label="IMR")
ggplot(data=prb)+
geom_point(mapping= aes(x=TFR, y=IMR))+
geom_smooth(mapping= aes(x=TFR, y=IMR) , method = "loess")+
ggtitle(label = "Relationship between Total Fertility and Infant Mortality", subtitle = "2008 Estimates")+
xlab(label = "TFR")+
ylab(label="IMR")
ggplot(data=prb,mapping= aes(x=TFR, y=PercPopLT15))+
geom_point()+
geom_smooth( method = "lm")+
ggtitle(label = "Relationship between Total Fertility and Percent under age 15", subtitle = "2008 Estimates-linear fit")+
xlab(label = "Percent under age 15")+
ylab(label="IMR")
ggplot(data=prb, mapping= aes(x=TFR, y=PercPopLT15))+
geom_point()+
geom_smooth( method = "loess")+
ggtitle(label = "Relationship between Total Fertility and Percent under age 15", subtitle = "2008 Estimates- loess fit")+
xlab(label = "Percent under age 15")+
ylab(label="IMR")
?lm
?t.test
??"linear model"
RSiteSearch("heteroskedasticity")
getwd()
setwd("C:/Users/ozd504/Google Drive/classes/dem7273/class_17/code")
install.packages("car")
library(car)
library(dplyr)
library(Hmisc)
x<-3
x
x< -3
x<-seq(0:20)
x
x[5]
x[5:10]
x== 5
x>5 5
x>5
x<-c("a", "b", "c")
x
is.numeric(x)
is.character(x)
View(prb)
table(is.na(prb$PercPop1549HIVAIDS2001))
x
x<-c(1,2,3,4,5 ,NA)
x
x<-ifelse(is.na(x)==T, mean(x, na.rm=T), x)
x
View(mydat)
View(prb)
View(prb)
table(prb$Continent, prb$Region)
table(prb$Continent, is.na(prb$PercPop1549HIVAIDS2001))
paste("Corey", "Sparks")
source("https://raw.githubusercontent.com/coreysparks/Rcode/master/install_first_short.R")
install.packages(c("devtools", "tidyverse", "bootstrap", "lmtest", "car", "Hmisc", "sandwich", "multcomp", "knitr", "lattice", "survey", "pscl", "ctv", "ggplot2", "acs", "ggmap", "dplyr", "sjPlot", "survey"), dependencies = T)
knitr::opts_chunk$set(echo = TRUE)
library(haven)
library(car)
library(stargazer)
library(survey)
library(questionr)
library(dplyr)
library(tidyverse)
library(gssr)
library(survey)
library(readr)
library(tableone, quietly = T)
library(ggplot2, quietly = T)
library(caret, quietly = T)
library(tableone)
gss2018<- read_sav("~/Downloads/OneDrive_1_4-7-2021/GSS7218_R3.sav")
nams<-names(gss2018)
head(nams, n=10)
#we see some names are lower case, some are upper and some have a little _ in the first position. This is a nightmare.
newnames<-tolower(gsub(pattern = "_",replacement =  "",x =  nams))
names(gss2018)<-newnames
gss2018<- gss2018 %>%
select(wtssnr,condom,partopen,hivkiss,aidscndm,educ,vstrat,rincome,sex,age,race,) %>%
mutate( sex=ifelse(sex==1,"Female",
ifelse(sex==0, "Male", NA
))) %>%
mutate(rincome = car::Recode(rincome,recodes="1:4='< $5000'; 5:10='$5000 - $19,999'; 11='$20000 - $24999'; 12='$25000 and more';else=NA",as.factor=T ),
educ = car::Recode(educ,recodes="0='Noschooling'; 1:4='Prim'; 5:10='somehs'; 11:12='hsgrad'; 13:14='somecol'; 15:20='colgrad'; 97:99=NA", as.factor=T ),
race = car::Recode(race,recodes="'1'='NH-White';'2'='NH-Black';'3'='Other';else=NA",as.factor=T ),
age = car::Recode(age,recodes="1='18-20';2='21-24';3='25-29';4='30-35';else=NA"),
condom = car::Recode(condom,recodes="1='Used last time'; 2='Not used'; else=NA", as.factor=T), partopen = car::Recode(partopen,recodes="0='No partner'; 1='1 partner'; 2='2 partners'; 3:100='More than 2 partners';else=NA",as.factor=T ),
hivkiss=ifelse(hivkiss==1, "True",
ifelse(hivkiss==2, "False", NA )),
aidscndm=ifelse(aidscndm==1, "Yes",
ifelse(aidscndm==2, "No",NA)))
gss2018<- zap_lables(gss2018)
gss2018<- zap_labels(gss2018)
gss2018<- gss2018 %>%
select(wtssnr,condom,partopen,hivkiss,aidscndm,educ,vstrat,rincome,sex,age,race,) %>%
mutate( sex=ifelse(sex==1,"Female",
ifelse(sex==0, "Male", NA
))) %>%
mutate(rincome = car::Recode(rincome,recodes="1:4='< $5000'; 5:10='$5000 - $19,999'; 11='$20000 - $24999'; 12='$25000 and more';else=NA",as.factor=T ),
educ = car::Recode(educ,recodes="0='Noschooling'; 1:4='Prim'; 5:10='somehs'; 11:12='hsgrad'; 13:14='somecol'; 15:20='colgrad'; 97:99=NA", as.factor=T ),
race = car::Recode(race,recodes="'1'='NH-White';'2'='NH-Black';'3'='Other';else=NA",as.factor=T ),
age = car::Recode(age,recodes="1='18-20';2='21-24';3='25-29';4='30-35';else=NA"),
condom = car::Recode(condom,recodes="1='Used last time'; 2='Not used'; else=NA", as.factor=T), partopen = car::Recode(partopen,recodes="0='No partner'; 1='1 partner'; 2='2 partners'; 3:100='More than 2 partners';else=NA",as.factor=T ),
hivkiss=ifelse(hivkiss==1, "True",
ifelse(hivkiss==2, "False", NA )),
aidscndm=ifelse(aidscndm==1, "Yes",
ifelse(aidscndm==2, "No",NA)))
library(sf)
library(censusapi)
Sys.setenv(CENSUS_KEY="f67be5a86e696eebf0c84a5a20d85f2c04f7e9ef")
![IPUMS - Waiting](C:/Users/ozd504/OneDrive - University of Texas at San Antonio/ipums1.PNG)
knitr::opts_chunk$set(echo = TRUE)
library(demography)
library(ggplot2)
library(tidyverse)
library(StMoMo)
library(fds)
usdat<-hmd.mx(country = "USA", username = "corey.sparks@utsa.edu", password = "1429845433", label="USA")
AUSStMoMO <- StMoMoData(usdat,series = "male")
summary(AUSStMoMO)
D<-as.numeric(AUSStMoMO$Dxt)
E<-as.numeric(AUSStMoMO$Ext)
nage<-dim(AUSStMoMO$Dxt)[1]
nyear<-dim(AUSStMoMO$Dxt)[2]
age<-rep(AUSStMoMO$ages,nyear )
years<-rep(AUSStMoMO$years, nage)
dat<-data.frame(D=round(D,0), E=E, age=age, years=years)
dat$lr<-log(dat$D/dat$E)
library(mgcv)
fit1<-gam(lr~s(age)+years, family = gaussian,data= dat)
summary(fit1)
new<-expand.grid(age=seq(50,90,10), years=seq(2018, 2050,1))
new$est<-predict(fit1, newdata=new)
plot(y=new$est[new$age==60], x=new$years[new$age==60])
lines(y=new$est[new$age==70], x=new$years[new$age==70], col=2)
lines(y=new$est[new$age==80], x=new$years[new$age==80], col=3)
library(dplyr)
library(ggplot2)
new%>%
ggplot(aes(x=age, y=est, group=years, color=years))+geom_line()
Years <- 1933:2017
Age <- 1:111
d <- AUSStMoMO$Dxt
e <- AUSStMoMO$Ext
m <- d/e
m <- log(m)
n.x = nrow(m) # 111
n.y = ncol(m) # 85
m_mat <- matrix(m, nrow = n.x, ncol = n.y) # 111 X 85
plot(x=Age, y=m_mat[,1], type = "l") #mortality of all ages in year 1933
# Mean log mortality for all age groups under consideration (Age)
a_age <- rowMeans(m_mat)
lines(x = Age, y = a_age, col = 2)#average mortality for all age groups
head(m_mat)
test<-svd(m_mat)
test
?prcomp
test<-prcomp(m_mat)
test
plot(test$rotation[, 1])
plot(test$rotation[1, ])
plot(test$rotation[, 1])
plot(test$rotation[, 2])
plot(test$rotation[, 1], type="l")
plot(test$rotation[, 2], type="l")
plot(test$rotation[, 3], type="l")
plot(test$rotation[, 4], type="l")
plot(test$rotation[, 5], type="l")
plot(Test)
plot(test)
plot(test$rotation[, 1], type="l")
plot(test$rotation[, 2], type="l")
plot(test$rotation[, 3], type="l")
# plotting mortality for Age = 65 as a trial run to see if code is working
# as exxpected
plot(x = Years, y = m_mat[65,], pch = 18, xlab = "Years", ylab = "log m", col = 2) #working!!!
Years <- 1933:2017
Age <- 1:111
d <- AUSStMoMO$Dxt
e <- AUSStMoMO$Ext
m <- d/e
m <- log(m)
n.x = nrow(m) # 111
n.y = ncol(m) # 85
m_mat <- matrix(m, nrow = n.x, ncol = n.y) # 111 X 85
plot(x=Age, y=m_mat[,1], type = "l") #mortality of all ages in year 1933
# Mean log mortality for all age groups under consideration (Age)
a_age <- rowMeans(m_mat)
lines(x = Age, y = a_age, col = 2)#average mortality for all age groups
# plotting mortality for Age = 65 as a trial run to see if code is working
# as exxpected
plot(x = Years, y = m_mat[65,], pch = 18, xlab = "Years", ylab = "log m", col = 2) #working!!!
# Average mortality across each year
a_year <- colMeans(m_mat)
#We need to estimate parameters ax, bx and kt of the Lee-Carter model
# ax is the avg of log mortality rates over time. ie sum(log m)/n.y
# avg of log rates -> a_hat <- rowSums(m)/94
# Subtracting a from all years in m_mat
m_hat <- matrix(1, nrow = n.y, ncol = n.x) #Dummy matrix with dim 85 X 111
m_hat <- t(m_mat)
m_mat <- t(m_mat)
for(i in 1:n.y) m_hat[,i] <- m_mat[,i] - a_age[i]
m_hat <- m_hat[,1:85]
age_mod <- 1:85
#SVD
svd_ <- svd(m_hat,1,1)
v <- svd_$v
u <- svd_$u
d <- svd_$d
b <- v/sum(v)
k <- u * sum(v) * d[1]
fit_1 = a_age[age_mod] + (b * k[1])
plot(x = age_mod, y = m_mat[1,age_mod], pch = 19, xlab = "Age", ylab = "m")
lines(x = age_mod, y = fit_1, col = 2, lwd = 2, xlab = "Age", ylab = "m")
sums<-sum(test$rotation[, 1:3])
plot(sums, type="l")
sums
sums<-apply(test$rotation[, 1:3], 1, sum)
plot(sums, type="l")
knitr::opts_chunk$set(echo = TRUE)
t1<-data.frame(Day = c(rep("Tuesday", 7), rep("Wednesday", 7)),
topic = c("Introduction/What is R?",
"Installing R and Rstudio on your computer",
"Introduction to Rstudio",
"Break",
"Reading common files into R",
"Using R to summarize data",
"Q&A",
"Basic ggplot",
"Break",
"Basic dplyr",
"R file types",
"Common packages",
"Q&A"))
knitr::kable(t1, caption = "Agenda", align = "c", format="html")
))
knitr::opts_chunk$set(echo = TRUE)
t1<-data.frame(Day = c(rep("Tuesday", 7), rep("Wednesday", 7)),
topic = c("Introduction/What is R?",
"Installing R and Rstudio on your computer",
"Introduction to Rstudio",
"Break",
"Reading common files into R",
"Using R to summarize data",
"Q&A",
"Basic ggplot",
"Break",
"Basic dplyr",
"R file types",
"Common packages",
"Q&A"))
knitr::kable(t1, caption = "Agenda", align = "c", format="html")
prb = readr::read_csv(url("https://raw.githubusercontent.com/coreysparks/data/master/PRB2013_new.csv"))
summary(prb$region)
summary(as.factor(prb$continent))
summary(prb$tfr)
desc1 <- psych::describe(prb, fast = F)
gc()
prb = readr::read_csv(url("https://raw.githubusercontent.com/coreysparks/data/master/PRB2013_new.csv", headers = T))
library(readr)
PRB2013_new <- read_csv("~/Documents/GitHub/data/PRB2013_new.csv",
na = "NA")
View(PRB2013_new)
prb = readr::read_csv(url("https://raw.githubusercontent.com/coreysparks/r_courses/master/2018_WPDS_Data_Table_FINAL.csv",
headers = T))
prb = readr::read_csv(url("https://raw.githubusercontent.com/coreysparks/r_courses/master/2018_WPDS_Data_Table_FINAL.csv",
headers = T))
prb = readr::read_csv(url("https://raw.githubusercontent.com/coreysparks/r_courses/master/2018_WPDS_Data_Table_FINAL.csv"))
summary(prb$region)
summary(as.factor(prb$continent))
summary(prb$tfr)
desc1 <- psych::describe(prb, fast = F)
print(desc1, short = T)
desc3<-skimr::skim(prb)
desc3
table(prb$continent)
knitr::opts_chunk$set(echo = TRUE)
t1<-data.frame(Day = c( rep("Wednesday", 7)),
topic = c("Q&A",
"Basic ggplot",
"Break",
"Basic dplyr",
"R file types",
"Common packages",
"Q&A"))
knitr::kable(t1, caption = "Agenda", align = "c", format="html")
library(ggplot2)
ggplot(data=prb,
mapping=aes(x = tfr))+
geom_histogram()+
ggtitle(label = "Distribution of the Total Fertility Rate, 2018")+
xlab(label = "TFR")
knitr::opts_chunk$set(echo = TRUE)
t1=data.frame(Day = c( rep("Wednesday", 7)),
topic = c("Q&A",
"Basic ggplot",
"Break",
"Basic dplyr",
"R file types",
"Common packages",
"Q&A"))
knitr::kable(t1, caption = "Agenda", align = "c", format="html")
library(readr, quietly = TRUE)
prb = read_csv(file = "https://raw.githubusercontent.com/coreysparks/r_courses/master/2018_WPDS_Data_Table_FINAL.csv")
names(prb) = tolower(names(prb))
library(ggplot2)
ggplot(data=prb,
mapping=aes(x = tfr))+
geom_histogram()+
ggtitle(label = "Distribution of the Total Fertility Rate, 2018")+
xlab(label = "TFR")
prb%>%
ggplot(mapping=aes(x = tfr))+
geom_histogram()+
ggtitle(label = "Distribution of the Total Fertility Rate, 2018")+
xlab(label = "TFR")
knitr::opts_chunk$set(echo = TRUE)
t1=data.frame(Day = c( rep("Wednesday", 7)),
topic = c("Q&A",
"Basic ggplot",
"Break",
"Basic dplyr",
"R file types",
"Common packages",
"Q&A"))
knitr::kable(t1, caption = "Agenda", align = "c", format="html")
library(readr, quietly = TRUE)
prb = read_csv(file = "https://raw.githubusercontent.com/coreysparks/r_courses/master/2018_WPDS_Data_Table_FINAL.csv")
names(prb) = tolower(names(prb))
library(tidyverse)
library(ggplot2)
ggplot(data=prb,
mapping=aes(x = tfr))+
geom_histogram()+
ggtitle(label = "Distribution of the Total Fertility Rate, 2018")+
xlab(label = "TFR")
prb%>%
ggplot(mapping=aes(x = tfr))+
geom_histogram()+
ggtitle(label = "Distribution of the Total Fertility Rate, 2018")+
xlab(label = "TFR")
prb%>%
mutate(high_tfr = ifelse(test = tfr > 3,
yes = "high",
no = "low") )%>%
group_by(high_tfr)%>%
ggplot(mapping=aes(x = imr))+
geom_histogram(aes( fill = high_tfr))+
facet_wrap( ~ high_tfr)+
ggtitle(label = "Distribution of the Infant Mortality Rate, 2018",
subtitle = "Low and High Fertility Countries")+
xlab(label = "Infant Mortality Rate")
prb%>%
mutate(high_tfr = ifelse(test = tfr > 3,
yes = "high",
no = "low") )%>%
group_by(high_tfr)%>%
ggplot(mapping=aes(x = imr))+
geom_histogram(aes( fill = high_tfr))+
facet_wrap( ~ high_tfr)+
ggtitle(label = "Distribution of the Infant Mortality Rate, 2018",
subtitle = "Low and High Fertility Countries")+
xlab(label = "Infant Mortality Rate")
prb%>%
ggplot(mapping = aes(tfr,
colour = continent,
stat = ..density..))+
geom_density()+
ggtitle(label = "Distribution of the Total Fertility Rate by Continent",
subtitle = "2018 Estimates")+
xlab(label = "TFR")
prb%>%
ggplot( mapping = aes(x = continent, y = tfr))+
geom_boxplot()+
ggtitle(label = "Distribution of the Total Fertility Rate by Continent",
subtitle = "2018 Estimates")
prb%>%
ggplot( mapping = aes(x = continent, y = tfr))+
geom_boxplot()+
ggtitle(label = "Distribution of the Total Fertility Rate by Continent",
subtitle = "2018 Estimates")
prb%>%
ggplot( mapping = aes( x = continent,
y = tfr))+
geom_boxplot()+
ggtitle(label = "Distribution of the Total Fertility Rate by Continent",
subtitle = "2018 Estimates")+
coord_flip()
prb%>%
mutate(newname = paste(continent, region, sep = "-"))%>%
ggplot(aes(x = newname,
y = tfr,
fill = continent))+
geom_boxplot()+
coord_flip()+
ggtitle(label = "Distribution of the Total Fertility Rate by Continent",
subtitle = "2018 Estimates")
prb%>%
ggplot(mapping= aes(x = tfr,
y = imr))+
geom_point()+
ggtitle(label = "Relationship between Total Fertility and Infant Mortality",
subtitle = "2018 Estimates")+
xlab(label = "TFR")+
ylab(label = "IMR")
prb%>%
ggplot(mapping = aes(x = tfr,
y = imr))+
geom_point()+
geom_smooth(method = "lm",
color = "black",
se = F)+ #linear regression fit
geom_smooth(color = "blue",
method = "loess",
se = FALSE)+
ggtitle(label = "Relationship between Total Fertility and Infant Mortality",
subtitle = "2018 Estimates")+
xlab(label = "TFR")+
ylab(label = "IMR")
library(dplyr)
prb %>%
mutate(high_tfr = ifelse(test = tfr > 3,
yes =  "high",
no =  "low") )%>%
group_by(high_tfr) %>%
summarise(n = n(),
across(.cols = c(e0male, e0female, gnigdp, imr),
.fns = mean,
na.rm = TRUE))%>%
ungroup()
Sys.time()
Sys.time()+1
Sys.time()+1000
x = rnorm(100)
print(x)
x = rnorm(100)
print(x)
x = rnorm(100)
mean(x)
x = c(x, NA)
mean(x)
x = c(x NA)
length(x)
lenght(x)
mean(x)
length(x)
cat = 1
dog = 55
cat/dog
goose = cat/dog
load("~/Documents/GitHub/r_courses/prb_2008.Rdata")
library(readr)
PRB2008_All <- read_csv("PRB2008_All.csv")
View(PRB2008_All)
x = rnorm(100)
hist(x)
goose = cat/dog
x = rnorm(100)
hist(x)
print(x)
library(readr)
prb2 <- read_csv("2018_WPDS_Data_Table_FINAL.csv")
View(prb2)
library(readxl)
X02a_sex_overall_od_2017_2018 <- read_excel("~/OneDrive - University of Texas at San Antonio/02a.sex_overall_od_2017_2018.xlsx")
View(X02a_sex_overall_od_2017_2018)
load("~/Documents/GitHub/data/arf1516.Rdata")
library(haven)
prb2008_st12 <- read_dta("~/Documents/GitHub/data/prb2008_st12.dta")
View(prb2008_st12)
dat <- haven::read_sas("~/OneDrive - University of Texas at San Antonio/projects/carsey_brief/cps_00040.sas7bdat.gz")
prb3<- read.csv(url("https://raw.githubusercontent.com/coreysparks/data/master/PRB2008_All.csv"))
View(prb3)
prb2$cbr
summary(prb2$cbr)
x = rnorm(100)
x = c(x ,NA)
summary(x)
summary(prb2$pctmalehiv)
summary(prb2)
install.packages("psych")
psych::describe(prb2)
psych::describe(prb2$cbr)
desc3<-skimr::skim(prb2)
desc3
table(prb2$continent)
mean(prb2$cbr)
mean(prb2$pctmalehiv)
mean(prb2$pctmalehiv, na.rm = TRUE)
median(prb2$pctmalehiv, na.rm = TRUE)
fivenum(prb2$cbr)
?fivenum
library(psych)
library(dplyr)
installed.packages()
source("https://raw.githubusercontent.com/coreysparks/Rcode/master/install_first_7263.R")
